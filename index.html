<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Баскский язык - Подготовка к тесту</title>
    <style>
        /* Общие стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Шапка */
        header {
            background: linear-gradient(90deg, #4A6FA5, #6B8CBC);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Навигация */
        .game-modes {
            display: flex;
            justify-content: center;
            background-color: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            padding: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 15px 25px;
            border: none;
            background-color: #e9ecef;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mode-btn:hover {
            background-color: #dee2e6;
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background-color: #4A6FA5;
            color: white;
            box-shadow: 0 4px 12px rgba(74, 111, 165, 0.3);
        }

        .mode-btn i {
            font-size: 1.2rem;
        }

        /* Основное содержимое */
        main {
            padding: 40px;
            min-height: 500px;
        }

        /* Секции игры */
        .game-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .game-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .section-header h2 {
            font-size: 2rem;
            color: #4A6FA5;
            margin-bottom: 10px;
        }

        .section-header p {
            font-size: 1.1rem;
            color: #666;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Диалог */
        .dialogue-container {
            background-color: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            border-left: 5px solid #4A6FA5;
        }

        .dialogue-title {
            font-size: 1.4rem;
            color: #4A6FA5;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .dialogue-line {
            padding: 12px 20px;
            margin-bottom: 10px;
            background-color: white;
            border-radius: 8px;
            border-left: 4px solid #6B8CBC;
            font-size: 1.1rem;
            line-height: 1.5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .speaker {
            font-weight: bold;
            color: #4A6FA5;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .translation {
            font-size: 0.95rem;
            color: #666;
            font-style: italic;
            padding-left: 10px;
            border-left: 2px solid #e0e0e0;
            margin-top: 5px;
        }

        /* Игра 1: Собери диалог */
        .sort-instructions {
            text-align: center;
            font-size: 1.2rem;
            margin-bottom: 30px;
            color: #666;
            padding: 15px;
            background-color: #f0f7ff;
            border-radius: 10px;
        }

        .mobile-sort-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .mobile-sort-btn {
            padding: 12px 20px;
            background-color: #4A6FA5;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .mobile-sort-btn:hover {
            background-color: #3a5a8c;
        }

        .mobile-sort-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .sortable-container {
            margin: 30px 0;
        }

        .sortable-item {
            padding: 15px 20px;
            margin-bottom: 12px;
            background-color: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            cursor: pointer;
            user-select: none;
        }

        .sortable-item:hover {
            border-color: #6B8CBC;
            transform: translateX(5px);
        }

        .sortable-item.selected {
            border-color: #4A6FA5;
            background-color: #f0f7ff;
            transform: scale(1.02);
        }

        .number {
            background-color: #4A6FA5;
            color: white;
            min-width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .item-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .sort-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        /* Игра 2: Кто это сказал? */
        .speaker-question {
            text-align: center;
            font-size: 1.5rem;
            margin: 40px 0;
            padding: 30px;
            background-color: #f0f7ff;
            border-radius: 15px;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .basque-text {
            font-weight: 600;
            color: #2c5282;
        }

        .russian-translation {
            font-size: 1.2rem;
            color: #666;
            font-style: italic;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
        }

        .speaker-options {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .speaker-option {
            padding: 25px 40px;
            background-color: white;
            border: 2px solid #dee2e6;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.3rem;
            font-weight: 600;
            transition: all 0.3s ease;
            min-width: 200px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .speaker-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .speaker-option.correct {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .speaker-option.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .speaker-icon {
            font-size: 1.8rem;
        }

        /* Игра 3: Заполни пропуск */
        .gap-question {
            font-size: 1.4rem;
            line-height: 1.6;
            margin: 40px 0;
            padding: 30px;
            background-color: #f8f9fa;
            border-radius: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .gap-sentence {
            font-size: 1.5rem;
            color: #2c5282;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .gap-translation {
            font-size: 1.2rem;
            color: #666;
            font-style: italic;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            border-left: 4px solid #4A6FA5;
        }

        .gap {
            display: inline-block;
            width: 150px;
            border-bottom: 3px dashed #4A6FA5;
            margin: 0 10px;
            padding: 8px 0;
            font-weight: bold;
            color: #4A6FA5;
            text-align: center;
        }

        .gap-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .gap-option {
            padding: 20px 30px;
            background-color: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            min-width: 180px;
            text-align: center;
        }

        .gap-option:hover {
            border-color: #6B8CBC;
            transform: translateY(-3px);
        }

        .gap-option.correct {
            background-color: #d4edda;
            border-color: #28a745;
        }

        .gap-option.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
        }

        /* Кнопки */
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background-color: #4A6FA5;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3a5a8c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 111, 165, 0.3);
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }

        /* Индикатор прогресса */
        .progress-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }

        .progress-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #4A6FA5;
        }

        /* Сообщения */
        .feedback-message {
            text-align: center;
            font-size: 1.4rem;
            font-weight: 600;
            margin: 30px 0;
            padding: 20px;
            border-radius: 10px;
            animation: popIn 0.5s ease;
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .feedback-correct {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }

        .feedback-incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }

        .feedback-info {
            background-color: #fff3cd;
            color: #856404;
            border: 2px solid #ffc107;
        }

        /* Результаты */
        .results-container {
            text-align: center;
            padding: 40px;
            background-color: #f0f7ff;
            border-radius: 15px;
            margin: 30px 0;
        }

        .results-title {
            font-size: 2rem;
            color: #4A6FA5;
            margin-bottom: 20px;
        }

        .results-score {
            font-size: 3.5rem;
            font-weight: bold;
            color: #28a745;
            margin: 20px 0;
        }

        .results-message {
            font-size: 1.3rem;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* Подвал */
        footer {
            text-align: center;
            padding: 30px;
            color: #666;
            border-top: 1px solid #dee2e6;
            background-color: #f8f9fa;
        }

        /* Адаптивность */
        @media (max-width: 768px) {
            header {
                padding: 20px;
            }
            
            header h1 {
                font-size: 2rem;
            }
            
            .game-modes {
                flex-direction: column;
                align-items: center;
            }
            
            .mode-btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            main {
                padding: 20px;
            }
            
            .section-header h2 {
                font-size: 1.6rem;
            }
            
            .speaker-options, .gap-options {
                flex-direction: column;
                align-items: center;
            }
            
            .speaker-option, .gap-option {
                width: 100%;
                max-width: 300px;
            }
            
            .gap-question {
                font-size: 1.2rem;
                padding: 20px;
            }
            
            .sort-buttons, .mobile-sort-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn, .mobile-sort-btn {
                width: 100%;
                max-width: 300px;
            }
            
            .dialogue-line {
                padding: 15px;
            }
            
            .speaker-question {
                padding: 20px;
                font-size: 1.3rem;
            }
            
            .results-score {
                font-size: 2.5rem;
            }
        }

        @media (max-width: 480px) {
            .dialogue-line {
                font-size: 1rem;
            }
            
            .speaker-question {
                font-size: 1.2rem;
                padding: 15px;
            }
            
            .gap-sentence {
                font-size: 1.3rem;
            }
            
            .gap {
                width: 120px;
            }
            
            .sortable-item {
                padding: 12px 15px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-language"></i> Баскский язык: Подготовка к тесту</h1>
            <p>Запомните диалог на рынке и подготовьтесь к школьному тесту</p>
        </header>

        <nav class="game-modes">
            <button class="mode-btn active" data-mode="dialogue">
                <i class="fas fa-book"></i> Диалог
            </button>
            <button class="mode-btn" data-mode="sort">
                <i class="fas fa-sort-amount-down"></i> Собери диалог
            </button>
            <button class="mode-btn" data-mode="speaker">
                <i class="fas fa-user-check"></i> Кто это сказал?
            </button>
            <button class="mode-btn" data-mode="gap">
                <i class="fas fa-edit"></i> Заполни пропуск
            </button>
        </nav>

        <main>
            <!-- Секция с диалогом -->
            <section id="dialogue" class="game-section active">
                <div class="section-header">
                    <h2><i class="fas fa-comments"></i> Диалог на рынке</h2>
                    <p>Изучите этот диалог между Майте и продавцом, затем перейдите к упражнениям</p>
                </div>
                
                <div class="dialogue-container">
                    <div class="dialogue-title">Диалог на баскском рынке</div>
                    <div id="dialogue-content">
                        <!-- Диалог будет загружен через JavaScript -->
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-text">Изучите диалог, затем переходите к упражнениям</div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" id="start-exercises-btn">
                        <i class="fas fa-play-circle"></i> Начать упражнения
                    </button>
                </div>
            </section>

            <!-- Игра 1: Собери диалог -->
            <section id="sort" class="game-section">
                <div class="section-header">
                    <h2><i class="fas fa-sort-amount-down"></i> Собери диалог</h2>
                    <p>Расставьте реплики диалога в правильном порядке. Используйте кнопки для перемещения</p>
                </div>
                
                <div class="progress-container">
                    <div class="progress-text" id="sort-progress">Попытка 1 из 3</div>
                </div>
                
                <div class="sort-instructions">
                    <i class="fas fa-mobile-alt"></i> Нажмите на реплику, чтобы выбрать её, затем используйте кнопки для перемещения
                </div>
                
                <div class="mobile-sort-controls">
                    <button class="mobile-sort-btn" id="move-up-btn" disabled>
                        <i class="fas fa-arrow-up"></i> Поднять
                    </button>
                    <button class="mobile-sort-btn" id="move-down-btn" disabled>
                        <i class="fas fa-arrow-down"></i> Опустить
                    </button>
                </div>
                
                <div class="sortable-container" id="sortable-container">
                    <!-- Сортируемые элементы будут добавлены через JavaScript -->
                </div>
                
                <div class="feedback-message" id="sort-feedback" style="display: none;"></div>
                
                <div class="sort-buttons">
                    <button class="btn btn-secondary" id="check-order-btn">
                        <i class="fas fa-check"></i> Проверить порядок
                    </button>
                    <button class="btn btn-secondary" id="show-hint-btn">
                        <i class="fas fa-lightbulb"></i> Подсказка
                    </button>
                    <button class="btn btn-success" id="next-sort-btn" style="display: none;">
                        <i class="fas fa-forward"></i> Следующее задание
                    </button>
                </div>
            </section>

            <!-- Игра 2: Кто это сказал? -->
            <section id="speaker" class="game-section">
                <div class="section-header">
                    <h2><i class="fas fa-user-check"></i> Кто это сказал?</h2>
                    <p>Определите, кто сказал каждую реплику: Майте или продавец</p>
                </div>
                
                <div class="progress-container">
                    <div class="progress-text" id="speaker-progress">Вопрос 1 из 5</div>
                </div>
                
                <div class="speaker-question" id="speaker-question">
                    <!-- Вопрос будет загружен через JavaScript -->
                </div>
                
                <div class="speaker-options">
                    <div class="speaker-option" data-speaker="maite">
                        <i class="fas fa-female speaker-icon"></i>
                        <div>Maite</div>
                        <div style="font-size: 1rem; font-weight: normal;">(девочка)</div>
                    </div>
                    <div class="speaker-option" data-speaker="seller">
                        <i class="fas fa-store speaker-icon"></i>
                        <div>Salzailea</div>
                        <div style="font-size: 1rem; font-weight: normal;">(продавец)</div>
                    </div>
                </div>
                
                <div class="feedback-message" id="speaker-feedback" style="display: none;"></div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" id="next-speaker-btn" style="display: none;">
                        <i class="fas fa-forward"></i> Следующий вопрос
                    </button>
                </div>
            </section>

            <!-- Игра 3: Заполни пропуск -->
            <section id="gap" class="game-section">
                <div class="section-header">
                    <h2><i class="fas fa-edit"></i> Заполни пропуск</h2>
                    <p>Выберите правильное слово, чтобы заполнить пропуск в предложении</p>
                </div>
                
                <div class="progress-container">
                    <div class="progress-text" id="gap-progress">Вопрос 1 из 5</div>
                </div>
                
                <div class="gap-question" id="gap-question">
                    <!-- Вопрос с пропуском будет загружен через JavaScript -->
                </div>
                
                <div class="gap-options" id="gap-options">
                    <!-- Варианты ответов будут загружены через JavaScript -->
                </div>
                
                <div class="feedback-message" id="gap-feedback" style="display: none;"></div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" id="next-gap-btn" style="display: none;">
                        <i class="fas fa-forward"></i> Следующий вопрос
                    </button>
                </div>
            </section>
            
            <!-- Результаты -->
            <section id="results" class="game-section" style="display: none;">
                <div class="results-container">
                    <h2 class="results-title"><i class="fas fa-trophy"></i> Отличная работа!</h2>
                    <div class="results-score" id="final-score">0%</div>
                    <p class="results-message" id="results-message">Вы завершили все упражнения</p>
                    <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                        <button class="btn btn-primary" id="restart-all-btn">
                            <i class="fas fa-redo"></i> Начать заново
                        </button>
                        <button class="btn btn-secondary" id="back-to-dialogue-btn">
                            <i class="fas fa-book"></i> Вернуться к диалогу
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>Образовательная мини-игра для изучения баскского языка (Euskara)</p>
            <p>Интерфейс на русском • Уровень: начинающий (A1–A2)</p>
        </footer>
    </div>

    <script>
        // Basque dialogue data with Russian translations - CORRECTED VERSION
        const dialogue = [
            { 
                speaker: "Maite", 
                text: "Egun hon!",
                translation: "Добрый день!"
            },
            { 
                speaker: "Salzailea", 
                text: "Egun hon! Zer behar düzü? Lagüntzen ahal zaitüt!",
                translation: "Добрый день! Что вам нужно? Могу я вам помочь!"
            },
            { 
                speaker: "Maite", 
                text: "Baratzekiak behar dütüt, otoi.",
                translation: "Мне нужны овощи, пожалуйста."
            },
            { 
                speaker: "Salzailea", 
                text: "Soegin, baratzekiak heben dütügi. Zer nahi düzü?",
                translation: "Конечно, овощи здесь есть. Что вы хотите?"
            },
            { 
                speaker: "Maite", 
                text: "3 tipula, azalili 1 eta 5 porriü nahi dütüt, otoi.",
                translation: "Я хочу 3 луковицы, 1 цветную капусту и 5 пореев, пожалуйста."
            },
            { 
                speaker: "Salzailea", 
                text: "Pastanagreik nahi düzü?",
                translation: "Морковку хотите?"
            },
            { 
                speaker: "Maite", 
                text: "Zonbat balio düe?",
                translation: "Сколько это стоит?"
            },
            { 
                speaker: "Salzailea", 
                text: "3 pastanagrek 4 euro balio düe.",
                translation: "3 морковки стоят 4 евро."
            },
            { 
                speaker: "Maite", 
                text: "Kariöegi da! Ez eskerrik hanitx.",
                translation: "Это слишком дорого! Нет, спасибо."
            },
            { 
                speaker: "Salzailea", 
                text: "Beste zerbait behar düzü?",
                translation: "Ещё что-нибудь нужно?"
            },
            { 
                speaker: "Maite", 
                text: "Bai, lürsagarrak behar dütüt zopa egiteko!",
                translation: "Да, мне нужны яблоки для супа!"
            },
            { 
                speaker: "Salzailea", 
                text: "Zonbat nahi dütüzü?",
                translation: "Сколько вы хотите?"
            },
            { 
                speaker: "Maite", 
                text: "10 bat lürsagar nahi dütüt, otoi.",
                translation: "Я хочу 10 яблок, пожалуйста."
            },
            { 
                speaker: "Salzailea", 
                text: "Orotara 27 euro otoi.",
                translation: "Всего 27 евро, пожалуйста."
            },
            { 
                speaker: "Maite", 
                text: "Orotara? Ez da merke! Tori 30 euro.",
                translation: "Всего? Это не дёшево! Вот 30 евро."
            },
            { 
                speaker: "Salzailea", 
                text: "Eta tori 3 euro.",
                translation: "И вот 3 евро сдачи."
            },
            { 
                speaker: "Maite", 
                text: "Eskerrik hanitx, adio.",
                translation: "Большое спасибо, до свидания."
            },
            { 
                speaker: "Salzailea", 
                text: "Izan ontsa, adio.",
                translation: "Будьте здоровы, до свидания."
            }
        ];

        // Game state
        const gameState = {
            currentMode: 'dialogue',
            sortAttempts: 0,
            sortSelectedIndex: -1,
            speakerQuestions: [],
            currentSpeakerQuestion: 0,
            speakerScore: 0,
            gapQuestions: [],
            currentGapQuestion: 0,
            gapScore: 0,
            totalScore: 0,
            exercisesCompleted: 0
        };

        // DOM elements
        const modeButtons = document.querySelectorAll('.mode-btn');
        const gameSections = document.querySelectorAll('.game-section');
        const dialogueContent = document.getElementById('dialogue-content');
        const sortableContainer = document.getElementById('sortable-container');
        const moveUpBtn = document.getElementById('move-up-btn');
        const moveDownBtn = document.getElementById('move-down-btn');
        const checkOrderBtn = document.getElementById('check-order-btn');
        const showHintBtn = document.getElementById('show-hint-btn');
        const nextSortBtn = document.getElementById('next-sort-btn');
        const sortFeedback = document.getElementById('sort-feedback');
        const sortProgress = document.getElementById('sort-progress');
        const speakerQuestion = document.getElementById('speaker-question');
        const speakerOptions = document.querySelectorAll('.speaker-option');
        const speakerFeedback = document.getElementById('speaker-feedback');
        const nextSpeakerBtn = document.getElementById('next-speaker-btn');
        const speakerProgress = document.getElementById('speaker-progress');
        const gapQuestion = document.getElementById('gap-question');
        const gapOptionsContainer = document.getElementById('gap-options');
        const gapFeedback = document.getElementById('gap-feedback');
        const nextGapBtn = document.getElementById('next-gap-btn');
        const gapProgress = document.getElementById('gap-progress');
        const startExercisesBtn = document.getElementById('start-exercises-btn');
        const resultsSection = document.getElementById('results');
        const finalScore = document.getElementById('final-score');
        const resultsMessage = document.getElementById('results-message');
        const restartAllBtn = document.getElementById('restart-all-btn');
        const backToDialogueBtn = document.getElementById('back-to-dialogue-btn');

        // Initialize the game
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            setupEventListeners();
        });

        // Initialize game data
        function initGame() {
            // Load dialogue
            loadDialogue();
            
            // Initialize sort game
            initSortGame();
            
            // Initialize speaker game
            initSpeakerGame();
            
            // Initialize gap game
            initGapGame();
        }

        // Set up event listeners
        function setupEventListeners() {
            // Mode navigation
            modeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const mode = button.getAttribute('data-mode');
                    switchMode(mode);
                });
            });
            
            // Start exercises button
            startExercisesBtn.addEventListener('click', () => {
                switchMode('sort');
            });
            
            // Sort game buttons
            moveUpBtn.addEventListener('click', moveItemUp);
            moveDownBtn.addEventListener('click', moveItemDown);
            checkOrderBtn.addEventListener('click', checkSortOrder);
            showHintBtn.addEventListener('click', showHint);
            nextSortBtn.addEventListener('click', nextSortQuestion);
            
            // Speaker game
            speakerOptions.forEach(option => {
                option.addEventListener('click', handleSpeakerAnswer);
            });
            nextSpeakerBtn.addEventListener('click', nextSpeakerQuestion);
            
            // Gap game
            nextGapBtn.addEventListener('click', nextGapQuestion);
            
            // Results
            restartAllBtn.addEventListener('click', restartAllGames);
            backToDialogueBtn.addEventListener('click', () => switchMode('dialogue'));
        }

        // Switch between game modes
        function switchMode(mode) {
            // Update active button
            modeButtons.forEach(button => {
                button.classList.remove('active');
                if (button.getAttribute('data-mode') === mode) {
                    button.classList.add('active');
                }
            });
            
            // Hide all sections
            gameSections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(mode).classList.add('active');
            gameState.currentMode = mode;
            
            // Reset if needed
            if (mode === 'sort') {
                initSortGame();
            } else if (mode === 'speaker') {
                initSpeakerGame();
            } else if (mode === 'gap') {
                initGapGame();
            }
        }

        // Load dialogue into the dialogue section
        function loadDialogue() {
            dialogueContent.innerHTML = '';
            
            dialogue.forEach((line, index) => {
                const lineElement = document.createElement('div');
                lineElement.className = 'dialogue-line';
                lineElement.innerHTML = `
                    <div class="speaker">
                        <i class="fas ${line.speaker === 'Maite' ? 'fa-female' : 'fa-store'}"></i>
                        ${line.speaker}:
                    </div>
                    <div><strong>${line.text}</strong></div>
                    <div class="translation">${line.translation}</div>
                `;
                dialogueContent.appendChild(lineElement);
            });
        }

        // Initialize sort game
        function initSortGame() {
            // Reset state
            gameState.sortAttempts = 0;
            gameState.sortSelectedIndex = -1;
            sortProgress.textContent = 'Попытка 1 из 3';
            sortFeedback.style.display = 'none';
            nextSortBtn.style.display = 'none';
            moveUpBtn.disabled = true;
            moveDownBtn.disabled = true;
            
            // Create shuffled lines
            const shuffledLines = [...dialogue].sort(() => Math.random() - 0.5);
            
            // Clear container
            sortableContainer.innerHTML = '';
            
            // Add sortable items
            shuffledLines.forEach((line, index) => {
                const item = document.createElement('div');
                item.className = 'sortable-item';
                item.setAttribute('data-index', index);
                item.setAttribute('data-original-index', dialogue.findIndex(l => 
                    l.text === line.text && l.speaker === line.speaker));
                item.innerHTML = `
                    <div class="number">${index + 1}</div>
                    <div class="item-content">
                        <div><strong>${line.speaker}:</strong> ${line.text}</div>
                        <div class="translation" style="font-size: 0.9rem;">${line.translation}</div>
                    </div>
                `;
                
                // Add click event for selection
                item.addEventListener('click', () => selectSortItem(index));
                
                sortableContainer.appendChild(item);
            });
            
            // Enable check button
            checkOrderBtn.disabled = false;
            showHintBtn.disabled = false;
        }

        // Select item in sort game
        function selectSortItem(index) {
            // Remove selection from all items
            const items = sortableContainer.querySelectorAll('.sortable-item');
            items.forEach(item => item.classList.remove('selected'));
            
            // Select clicked item
            items[index].classList.add('selected');
            gameState.sortSelectedIndex = index;
            
            // Enable/disable move buttons
            moveUpBtn.disabled = index === 0;
            moveDownBtn.disabled = index === items.length - 1;
        }

        // Move selected item up
        function moveItemUp() {
            if (gameState.sortSelectedIndex > 0) {
                const items = sortableContainer.querySelectorAll('.sortable-item');
                const selectedItem = items[gameState.sortSelectedIndex];
                const prevItem = items[gameState.sortSelectedIndex - 1];
                
                // Swap items
                sortableContainer.insertBefore(selectedItem, prevItem);
                
                // Update selected index
                gameState.sortSelectedIndex--;
                
                // Update numbers and button states
                updateSortNumbers();
                moveUpBtn.disabled = gameState.sortSelectedIndex === 0;
                moveDownBtn.disabled = gameState.sortSelectedIndex === items.length - 1;
            }
        }

        // Move selected item down
        function moveItemDown() {
            const items = sortableContainer.querySelectorAll('.sortable-item');
            if (gameState.sortSelectedIndex < items.length - 1) {
                const selectedItem = items[gameState.sortSelectedIndex];
                const nextItem = items[gameState.sortSelectedIndex + 1];
                
                // Swap items
                if (nextItem.nextSibling) {
                    sortableContainer.insertBefore(selectedItem, nextItem.nextSibling);
                } else {
                    sortableContainer.appendChild(selectedItem);
                }
                
                // Update selected index
                gameState.sortSelectedIndex++;
                
                // Update numbers and button states
                updateSortNumbers();
                moveUpBtn.disabled = gameState.sortSelectedIndex === 0;
                moveDownBtn.disabled = gameState.sortSelectedIndex === items.length - 1;
            }
        }

        // Update numbers in sort game
        function updateSortNumbers() {
            const items = sortableContainer.querySelectorAll('.sortable-item');
            items.forEach((item, index) => {
                item.querySelector('.number').textContent = index + 1;
            });
        }

        // Check if sort order is correct
        function checkSortOrder() {
            gameState.sortAttempts++;
            sortProgress.textContent = `Попытка ${gameState.sortAttempts} из 3`;
            
            const items = sortableContainer.querySelectorAll('.sortable-item');
            let correctCount = 0;
            
            items.forEach((item, index) => {
                const originalIndex = parseInt(item.getAttribute('data-original-index'));
                
                if (originalIndex === index) {
                    correctCount++;
                }
            });
            
            // Show feedback
            sortFeedback.style.display = 'block';
            
            if (correctCount === dialogue.length) {
                sortFeedback.textContent = 'Правильно! Отличная работа!';
                sortFeedback.className = 'feedback-message feedback-correct';
                checkOrderBtn.disabled = true;
                showHintBtn.disabled = true;
                moveUpBtn.disabled = true;
                moveDownBtn.disabled = true;
                nextSortBtn.style.display = 'inline-flex';
                gameState.exercisesCompleted++;
            } else if (gameState.sortAttempts >= 3) {
                sortFeedback.textContent = 'Есть ошибки. Показываем правильный порядок...';
                sortFeedback.className = 'feedback-message feedback-incorrect';
                showCorrectOrder();
                checkOrderBtn.disabled = true;
                showHintBtn.disabled = true;
                moveUpBtn.disabled = true;
                moveDownBtn.disabled = true;
                nextSortBtn.style.display = 'inline-flex';
                gameState.exercisesCompleted++;
            } else {
                sortFeedback.textContent = `Есть ошибки. Правильно: ${correctCount} из ${dialogue.length}`;
                sortFeedback.className = 'feedback-message feedback-incorrect';
            }
        }

        // Show correct order
        function showCorrectOrder() {
            const items = sortableContainer.querySelectorAll('.sortable-item');
            
            // Clear container
            sortableContainer.innerHTML = '';
            
            // Add items in correct order
            dialogue.forEach((line, index) => {
                const item = document.createElement('div');
                item.className = 'sortable-item';
                item.innerHTML = `
                    <div class="number" style="background-color: #28a745;">${index + 1}</div>
                    <div class="item-content">
                        <div><strong>${line.speaker}:</strong> ${line.text}</div>
                        <div class="translation" style="font-size: 0.9rem;">${line.translation}</div>
                    </div>
                `;
                sortableContainer.appendChild(item);
            });
        }

        // Show hint for sort game
        function showHint() {
            sortFeedback.style.display = 'block';
            sortFeedback.textContent = 'Первая реплика: "Egun hon!" говорит Maite. Последняя: "Izan ontsa, adio." говорит продавец.';
            sortFeedback.className = 'feedback-message feedback-info';
            
            // Hide after 5 seconds
            setTimeout(() => {
                sortFeedback.style.display = 'none';
            }, 5000);
        }

        // Move to next sort question (actually goes to speaker game)
        function nextSortQuestion() {
            switchMode('speaker');
        }

        // Initialize speaker game
        function initSpeakerGame() {
            // Create questions
            gameState.speakerQuestions = [];
            gameState.currentSpeakerQuestion = 0;
            gameState.speakerScore = 0;
            
            // Select 5 random lines from dialogue
            const shuffledDialogue = [...dialogue].sort(() => Math.random() - 0.5);
            const selectedLines = shuffledDialogue.slice(0, 5);
            
            selectedLines.forEach(line => {
                gameState.speakerQuestions.push({
                    text: line.text,
                    translation: line.translation,
                    correctSpeaker: line.speaker.toLowerCase(),
                    speakerName: line.speaker
                });
            });
            
            // Load first question
            loadSpeakerQuestion(0);
            speakerProgress.textContent = 'Вопрос 1 из 5';
            speakerFeedback.style.display = 'none';
            nextSpeakerBtn.style.display = 'none';
            
            // Reset options
            speakerOptions.forEach(option => {
                option.classList.remove('correct', 'incorrect');
                option.style.pointerEvents = 'auto';
            });
        }

        // Load speaker question
        function loadSpeakerQuestion(index) {
            if (index < gameState.speakerQuestions.length) {
                const question = gameState.speakerQuestions[index];
                speakerQuestion.innerHTML = `
                    <div class="basque-text">"${question.text}"</div>
                    <div class="russian-translation">${question.translation}</div>
                    <div style="font-size: 1.2rem; color: #4A6FA5; margin-top: 10px;">Кто это сказал?</div>
                `;
                
                // Reset options
                speakerOptions.forEach(option => {
                    option.classList.remove('correct', 'incorrect');
                    option.style.pointerEvents = 'auto';
                });
                
                speakerFeedback.style.display = 'none';
                nextSpeakerBtn.style.display = 'none';
                
                speakerProgress.textContent = `Вопрос ${index + 1} из 5`;
            } else {
                // All questions answered, show results
                showSpeakerResults();
            }
        }

        // Handle speaker answer
        function handleSpeakerAnswer(e) {
            const selectedSpeaker = this.getAttribute('data-speaker');
            const question = gameState.speakerQuestions[gameState.currentSpeakerQuestion];
            
            // Disable further clicks
            speakerOptions.forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // Check answer
            const isCorrect = selectedSpeaker === question.correctSpeaker;
            
            // Update score
            if (isCorrect) {
                gameState.speakerScore++;
            }
            
            // Highlight correct/incorrect
            speakerOptions.forEach(option => {
                if (option.getAttribute('data-speaker') === question.correctSpeaker) {
                    option.classList.add('correct');
                } else if (option === this && !isCorrect) {
                    option.classList.add('incorrect');
                }
            });
            
            // Show feedback
            speakerFeedback.style.display = 'block';
            if (isCorrect) {
                speakerFeedback.textContent = 'Правильно! Молодец!';
                speakerFeedback.className = 'feedback-message feedback-correct';
            } else {
                speakerFeedback.textContent = `Неправильно. Это сказал(а): ${question.speakerName}`;
                speakerFeedback.className = 'feedback-message feedback-incorrect';
            }
            
            // Show next button
            nextSpeakerBtn.style.display = 'inline-flex';
        }

        // Move to next speaker question
        function nextSpeakerQuestion() {
            gameState.currentSpeakerQuestion++;
            
            if (gameState.currentSpeakerQuestion < gameState.speakerQuestions.length) {
                loadSpeakerQuestion(gameState.currentSpeakerQuestion);
            } else {
                showSpeakerResults();
            }
        }

        // Show speaker game results
        function showSpeakerResults() {
            const percentage = Math.round((gameState.speakerScore / gameState.speakerQuestions.length) * 100);
            speakerQuestion.innerHTML = `
                <div style="font-size: 1.8rem; color: #4A6FA5;">
                    <i class="fas fa-chart-bar"></i> Результат
                </div>
                <div style="font-size: 2rem; font-weight: bold; color: #28a745;">
                    ${gameState.speakerScore} из ${gameState.speakerQuestions.length}
                </div>
                <div style="font-size: 1.5rem; color: #666;">
                    (${percentage}%)
                </div>
            `;
            
            let message = '';
            if (percentage === 100) {
                message = 'Отлично! Вы прекрасно различаете говорящих!';
            } else if (percentage >= 80) {
                message = 'Хорошо! Вы хорошо различаете говорящих!';
            } else if (percentage >= 60) {
                message = 'Неплохо, но можно лучше!';
            } else {
                message = 'Попробуйте ещё раз, чтобы улучшить результат!';
            }
            
            speakerFeedback.textContent = message;
            speakerFeedback.className = 'feedback-message feedback-info';
            speakerFeedback.style.display = 'block';
            
            // Hide options
            speakerOptions.forEach(option => {
                option.style.display = 'none';
            });
            
            // Change next button to continue
            nextSpeakerBtn.innerHTML = '<i class="fas fa-forward"></i> Следующая игра';
            nextSpeakerBtn.onclick = () => {
                gameState.exercisesCompleted++;
                switchMode('gap');
            };
            nextSpeakerBtn.style.display = 'inline-flex';
        }

        // Initialize gap game
        function initGapGame() {
            // Create gap questions
            gameState.gapQuestions = [];
            gameState.currentGapQuestion = 0;
            gameState.gapScore = 0;
            
            // Gap sentences with translations - based on the CORRECTED dialogue
            const sentences = [
                { 
                    text: "Egun ___!", 
                    correct: "hon", 
                    options: ["hon", "on", "ondo"],
                    translation: "Добрый ___!"
                },
                { 
                    text: "Zer behar ___?", 
                    correct: "düzü", 
                    options: ["düzü", "dütüt", "düe"],
                    translation: "Что вам ___?"
                },
                { 
                    text: "Baratzekiak behar ___, otoi.", 
                    correct: "dütüt", 
                    options: ["dütüt", "düzü", "düe"],
                    translation: "Мне нужны овощи, ___."
                },
                { 
                    text: "3 tipula, azalili 1 ___ 5 porriü nahi dütüt, otoi.", 
                    correct: "eta", 
                    options: ["eta", "edo", "bai"],
                    translation: "Я хочу 3 луковицы, 1 цветную капусту ___ 5 пореев, пожалуйста."
                },
                { 
                    text: "___ balio düe?", 
                    correct: "Zonbat", 
                    options: ["Zonbat", "Zenbat", "Nonbat"],
                    translation: "___ это стоит?"
                },
                { 
                    text: "3 pastanagrek 4 euro ___ düe.", 
                    correct: "balio", 
                    options: ["balio", "balioz", "baliatu"],
                    translation: "3 морковки ___ 4 евро."
                },
                { 
                    text: "Kariöegi da! Ez eskerrik ___", 
                    correct: "hanitx", 
                    options: ["hanitx", "asko", "polita"],
                    translation: "Это слишком дорого! Нет, спасибо ___"
                },
                { 
                    text: "Beste zerbait ___ düzü?", 
                    correct: "behar", 
                    options: ["behar", "nahi", "izan"],
                    translation: "Ещё что-нибудь ___ нужно?"
                },
                { 
                    text: "10 bat lürsagar nahi dütüt, ___.", 
                    correct: "otoi", 
                    options: ["otoi", "mesedez", "barkatu"],
                    translation: "Я хочу 10 яблок, ___."
                },
                { 
                    text: "Orotara 27 euro ___.", 
                    correct: "otoi", 
                    options: ["otoi", "bai", "ez"],
                    translation: "Всего 27 евро, ___."
                },
                { 
                    text: "Eskerrik hanitx, ___.", 
                    correct: "adio", 
                    options: ["adio", "agur", "kaixo"],
                    translation: "Большое спасибо, ___."
                }
            ];
            
            // Select 5 random sentences
            const shuffledSentences = [...sentences].sort(() => Math.random() - 0.5);
            const selectedSentences = shuffledSentences.slice(0, 5);
            
            selectedSentences.forEach(sentence => {
                // Shuffle options
                const shuffledOptions = [...sentence.options].sort(() => Math.random() - 0.5);
                
                gameState.gapQuestions.push({
                    text: sentence.text,
                    translation: sentence.translation,
                    correct: sentence.correct,
                    options: shuffledOptions
                });
            });
            
            // Load first question
            loadGapQuestion(0);
            gapProgress.textContent = 'Вопрос 1 из 5';
            gapFeedback.style.display = 'none';
            nextGapBtn.style.display = 'none';
        }

        // Load gap question
        function loadGapQuestion(index) {
            if (index < gameState.gapQuestions.length) {
                const question = gameState.gapQuestions[index];
                
                // Display question with gap
                const questionText = question.text.replace('___', '<span class="gap">______</span>');
                gapQuestion.innerHTML = `
                    <div class="gap-sentence">${questionText}</div>
                    <div class="gap-translation">${question.translation}</div>
                    <div style="font-size: 1.2rem; color: #4A6FA5; margin-top: 10px;">Выберите правильное слово:</div>
                `;
                
                // Clear options
                gapOptionsContainer.innerHTML = '';
                
                // Add options
                question.options.forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'gap-option';
                    optionElement.textContent = option;
                    optionElement.addEventListener('click', () => handleGapAnswer(optionElement, option, question.correct));
                    gapOptionsContainer.appendChild(optionElement);
                });
                
                gapFeedback.style.display = 'none';
                nextGapBtn.style.display = 'none';
                gapProgress.textContent = `Вопрос ${index + 1} из 5`;
            } else {
                // All questions answered
                showGapResults();
            }
        }

        // Handle gap answer
        function handleGapAnswer(element, selectedAnswer, correctAnswer) {
            // Disable all options
            const allOptions = gapOptionsContainer.querySelectorAll('.gap-option');
            allOptions.forEach(opt => {
                opt.style.pointerEvents = 'none';
                if (opt.textContent === correctAnswer) {
                    opt.classList.add('correct');
                } else if (opt === element && selectedAnswer !== correctAnswer) {
                    opt.classList.add('incorrect');
                }
            });
            
            // Check answer
            const isCorrect = selectedAnswer === correctAnswer;
            
            // Update score
            if (isCorrect) {
                gameState.gapScore++;
            }
            
            // Show feedback
            gapFeedback.style.display = 'block';
            if (isCorrect) {
                gapFeedback.textContent = 'Правильно! Отличная работа!';
                gapFeedback.className = 'feedback-message feedback-correct';
            } else {
                gapFeedback.textContent = `Неправильно. Правильный ответ: ${correctAnswer}`;
                gapFeedback.className = 'feedback-message feedback-incorrect';
            }
            
            // Show next button
            nextGapBtn.style.display = 'inline-flex';
        }

        // Move to next gap question
        function nextGapQuestion() {
            gameState.currentGapQuestion++;
            loadGapQuestion(gameState.currentGapQuestion);
        }

        // Show gap game results
        function showGapResults() {
            const percentage = Math.round((gameState.gapScore / gameState.gapQuestions.length) * 100);
            
            gapQuestion.innerHTML = `
                <div style="font-size: 1.8rem; color: #4A6FA5;">
                    <i class="fas fa-chart-line"></i> Результат
                </div>
                <div style="font-size: 2rem; font-weight: bold; color: #28a745;">
                    ${gameState.gapScore} из ${gameState.gapQuestions.length}
                </div>
                <div style="font-size: 1.5rem; color: #666;">
                    (${percentage}%)
                </div>
            `;
            
            let message = '';
            if (percentage === 100) {
                message = 'Превосходно! Вы отлично знаете эти слова!';
            } else if (percentage >= 80) {
                message = 'Очень хорошо! Вы хорошо знаете эти слова!';
            } else if (percentage >= 60) {
                message = 'Хороший результат! Продолжайте практиковаться!';
            } else {
                message = 'Попробуйте ещё раз, чтобы улучшить результат!';
            }
            
            gapFeedback.textContent = message;
            gapFeedback.className = 'feedback-message feedback-info';
            gapFeedback.style.display = 'block';
            
            // Hide options
            gapOptionsContainer.innerHTML = '';
            
            // Change next button to show results
            nextGapBtn.innerHTML = '<i class="fas fa-trophy"></i> Показать итоги';
            nextGapBtn.onclick = showFinalResults;
            nextGapBtn.style.display = 'inline-flex';
            
            gameState.exercisesCompleted++;
        }

        // Show final results
        function showFinalResults() {
            // Calculate total score
            const totalQuestions = 5 + 5; // 5 speaker questions + 5 gap questions
            const totalCorrect = gameState.speakerScore + gameState.gapScore;
            const totalPercentage = Math.round((totalCorrect / totalQuestions) * 100);
            
            // Update results display
            finalScore.textContent = `${totalPercentage}%`;
            
            let message = '';
            if (totalPercentage === 100) {
                message = 'Идеально! Вы прекрасно подготовились к тесту!';
            } else if (totalPercentage >= 80) {
                message = 'Отлично! Вы хорошо подготовились к тесту!';
            } else if (totalPercentage >= 60) {
                message = 'Хорошо! Вы готовы к тесту, но можно ещё попрактиковаться.';
            } else {
                message = 'Попробуйте пройти упражнения ещё раз для лучшей подготовки.';
            }
            
            resultsMessage.textContent = `${message} Правильных ответов: ${totalCorrect} из ${totalQuestions}`;
            
            // Show results section
            gameSections.forEach(section => {
                section.classList.remove('active');
            });
            resultsSection.style.display = 'block';
            resultsSection.classList.add('active');
        }

        // Restart all games
        function restartAllGames() {
            // Reset game state
            gameState.sortAttempts = 0;
            gameState.sortSelectedIndex = -1;
            gameState.currentSpeakerQuestion = 0;
            gameState.speakerScore = 0;
            gameState.currentGapQuestion = 0;
            gameState.gapScore = 0;
            gameState.exercisesCompleted = 0;
            
            // Reinitialize all games
            initSortGame();
            initSpeakerGame();
            initGapGame();
            
            // Go to dialogue section
            switchMode('dialogue');
        }
    </script>
</body>
</html>
